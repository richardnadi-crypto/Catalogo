<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Catálogo Naturalisima</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:20px; background:#f5fbf4; }
    h1 { text-align:center; color:#2e7d32; }
    #busqueda { margin:20px auto; display:block; width:80%; padding:10px; border:1px solid #ccc; border-radius:6px; }
    .layout { display:grid; grid-template-columns:1fr 300px; gap:20px; }
    @media(max-width:900px){ .layout{grid-template-columns:1fr;} }
    .grid { display:flex; flex-wrap:wrap; justify-content:center; gap:16px; }
    .producto {
      background:#fff; border:1px solid #ddd; border-radius:8px;
      width:260px; padding:12px; box-shadow:0 4px 10px rgba(0,0,0,0.08);
      display:flex; flex-direction:column; justify-content:space-between;
    }
    .producto img { width:100%; height:160px; object-fit:cover; border-radius:6px; margin-bottom:8px; }
    .producto strong { font-size:1.1em; color:#2e7d32; }
    .precio { color:#e74c3c; font-weight:bold; margin-top:6px; }
    .btn { margin-top:10px; padding:8px; background:#27ae60; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:bold; }
    .btn:hover { background:#219150; }
    .paginacion { text-align:center; margin-top:20px; }
    .paginacion button { margin:0 5px; padding:8px 12px; border-radius:6px; border:1px solid #ccc; cursor:pointer; }
    .paginacion button:disabled { opacity:0.5; cursor:not-allowed; }
    /* Carrito */
    .carrito { background:#fff; border:1px solid #ccc; border-radius:8px; padding:12px; box-shadow:0 4px 10px rgba(0,0,0,0.08); }
    .carrito h2 { margin-top:0; color:#2e7d32; }
    .carrito ul { list-style:none; padding:0; margin:0; }
    .carrito li { margin-bottom:8px; font-size:0.9em; }
    .carrito-total { font-weight:bold; margin-top:10px; }
    .carrito button { margin-top:10px; width:100%; padding:10px; background:#27ae60; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:bold; }
    .carrito button:hover { background:#219150; }
  </style>
</head>
<body>
  <h1>Catálogo Naturalisima</h1>
  <input id="busqueda" type="text" placeholder="Buscar producto por nombre, marca o categoría...">

  <div class="layout">
    <div>
      <div id="catalogo" class="grid"></div>
      <div class="paginacion">
        <button id="prev">Anterior</button>
        <span id="pagina"></span>
        <button id="next">Siguiente</button>
      </div>
    </div>
    <div class="carrito">
      <h2>Carrito</h2>
      <ul id="listaCarrito"></ul>
      <div class="carrito-total">Total: <span id="total">$0.00</span></div>
      <button id="finalizar">Finalizar compra</button>
    </div>
  </div>

  <script>
    const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ8d5wwRUWXBNcyzAuL0HyrWtMPMjGK-SZH4rBNgIPQpHopFpYkU-g2VHSOwxrulKG-1WoU_mruEF7T/pub?gid=272677879&single=true&output=csv';
    const WHATSAPP = 'https://wa.me/584143572264?text=';

    let productos = [];
    let paginaActual = 1;
    const productosPorPagina = 12;
    let carrito = [];

    async function cargarProductos() {
      const res = await fetch(SHEET_CSV_URL);
      const texto = await res.text();
      const lineas = texto.trim().split('\n');
      productos = lineas.slice(1).map(l => {
        const campos = l.split(',');
        return {
          nombre: campos[0],
          marca: campos[1],
          categoria: campos[2],
          subcategoria: campos[3],
          descripcion: campos[4],
          beneficios: campos[5],
          precio: campos[6],
          imagen: campos[7]
        };
      });
      mostrarPagina(productos);
      document.getElementById('busqueda').addEventListener('input', filtrar);
      document.getElementById('prev').addEventListener('click', () => cambiarPagina(-1));
      document.getElementById('next').addEventListener('click', () => cambiarPagina(1));
      document.getElementById('finalizar').addEventListener('click', finalizarCompra);
    }

    function mostrarPagina(lista) {
      const contenedor = document.getElementById('catalogo');
      contenedor.innerHTML = '';
      const inicio = (paginaActual - 1) * productosPorPagina;
      const fin = inicio + productosPorPagina;
      const paginaProductos = lista.slice(inicio, fin);

      paginaProductos.forEach(p => {
        const producto = document.createElement('div');
        producto.className = 'producto';
        producto.innerHTML = `
          <img src="${p.imagen || ''}" alt="${p.nombre}">
          <strong>${p.nombre}</strong>
          Marca: ${p.marca}<br>
          Categoría: ${p.categoria}<br>
          Subcategoría: ${p.subcategoria}<br>
          Descripción: ${p.descripcion}<br>
          Beneficios: ${p.beneficios}<br>
          <div class="precio">Precio: $${p.precio}</div>
          <button class="btn">Agregar al carrito</button>
        `;
        producto.querySelector('.btn').addEventListener('click', () => {
          carrito.push(p);
          renderCarrito();
        });
        contenedor.appendChild(producto);
      });

      document.getElementById('pagina').textContent = `Página ${paginaActual} de ${Math.ceil(lista.length / productosPorPagina)}`;
    }

    function cambiarPagina(direccion) {
      const totalPaginas = Math.ceil(productos.length / productosPorPagina);
      paginaActual = Math.min(Math.max(1, paginaActual + direccion), totalPaginas);
      mostrarPagina(productos);
    }

    function filtrar() {
      const q = document.getElementById('busqueda').value.toLowerCase();
      const filtrados = productos.filter(p =>
        Object.values(p).some(c => c.toLowerCase().includes(q))
      );
      paginaActual = 1;
      mostrarPagina(filtrados);
    }

    function renderCarrito() {
      const lista = document.getElementById('listaCarrito');
      lista.innerHTML = '';
      let total = 0;
      carrito.forEach((p, i) => {
        total += parseFloat(p.precio) || 0;
        const li = document.createElement('li');
        li.textContent = `${p.nombre} - $${p.precio}`;
        lista.appendChild(li);
      });
      document.getElementById('total').textContent = '$' + total.toFixed(2);
    }

    function finalizarCompra() {
      if (carrito.length === 0) return;
      let mensaje = "Hola, quiero comprar:\n";
      carrito.forEach(p => {
        mensaje += `- ${p.nombre} (Marca: ${p.marca}, Precio: $${p.precio})\n`;
      });
      const total = document.getElementById('total').textContent;
      mensaje += `\nTotal: ${total}`;
      const url = WHATSAPP + encodeURIComponent(mensaje);
      window.open(url, '_blank');
    }

    cargarProductos();
  </script>
</body>
</html>